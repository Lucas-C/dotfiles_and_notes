#!/usr/bin/env python3
# TODO: --margin 0
import sys
from qrcode import QRCode

if len(sys.argv) < 2:
    print("A target URL must be provided as argument", file=sys.stderr)
    exit(1)

url = sys.argv[1]

if not url.startswith("http"):
    print("Target URL must start with https:// or http://", file=sys.stderr)
    exit(1)

if len(sys.argv) > 2:
    img_path = sys.argv[2]
else:
    url_slug = url
    if "//" in url_slug:
        url_slug = url_slug.split("//")[1]
    while url_slug.endswith("/"):
        url_slug = url_slug[:-1]
    if "/" in url_slug:
        url_slug = url_slug.split("/")[-1]
    img_path = f"qrcode-{url_slug}.png"

qr = QRCode()
qr.add_data(url)
img = qr.make_image(back_color="transparent")
img.save(img_path)
print(f"Produced: {img_path}")
